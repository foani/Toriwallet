# TORI 지갑 내부 보안 감사 보고서 - 브라우저 확장 프로그램

## 개요

이 문서는 TORI 지갑 프로젝트의 브라우저 확장 프로그램에 대한 내부 보안 감사 결과를 기록합니다. 감사는 2025년 5월 6일부터 5월 9일까지 진행되었으며, 백그라운드 스크립트, 콘텐츠 스크립트, 인페이지 스크립트, UI 구성 요소, 웹3 프로바이더 등의 영역을 포함했습니다.

## 감사 범위

### 대상 코드
- `packages/extension/src/background/*`
- `packages/extension/src/contentScript/*`
- `packages/extension/src/inpage/*`
- `packages/extension/src/popup/*`
- `packages/extension/src/dapp/*`

### 평가 항목
1. 확장 프로그램 권한 및 접근 제어
2. 스크립트 간 통신 보안
3. 웹3 프로바이더 구현 안전성
4. dApp 연결 및 권한 관리
5. 데이터 저장 및 접근 보안
6. 트랜잭션 서명 및 확인 프로세스
7. UI 보안 (피싱 방지, 클릭재킹 보호 등)
8. 브라우저 확장 프로그램 관련 취약점

## 발견된 취약점 요약

총 11개의 보안 이슈가 발견되었으며, 심각도별 분류는 다음과 같습니다:

- **치명적(Critical)**: 1건
- **높음(High)**: 2건
- **중간(Medium)**: 3건
- **낮음(Low)**: 3건
- **정보성(Informational)**: 2건

## 주요 발견 사항

### 치명적(Critical)

#### 1. 인페이지 스크립트의 취약한 메시지 검증 (C-01)

**위치**: `packages/extension/src/inpage/messageBridge.ts`

**설명**: 인페이지 스크립트가 웹사이트로부터 받은 메시지를 충분히
검증하지 않고 처리하고 있어, 악의적인 웹사이트가 확장 프로그램의 권한을 이용해 사용자의 개인 키에 접근하거나 서명되지 않은 트랜잭션을 시작할 수 있는 취약점이 발견되었습니다.

**권장 수정 사항**: 모든 수신 메시지에 대해 엄격한 출처 검증, 메시지 형식 검증, 권한 확인 등의 보안 검증을 구현하고, 특히 트랜잭션 서명이나 개인 정보 접근과 관련된 요청은 사용자 확인을 필수로 요구하도록 수정합니다.

**상태**: 수정 완료

### 높음(High)

#### 1. 권한 검증 없는 dApp 연결 (H-01)

**위치**: `packages/extension/src/background/walletManager.ts`

**설명**: dApp과의 연결 과정에서 사용자의 명시적 확인 없이 일부 권한이 자동으로 승인되는 문제가 발견되었습니다. 이로 인해 악성 dApp이 사용자 모르게 일부 기능에 접근할 가능성이 있습니다.

**권장 수정 사항**: 모든 dApp 연결 요청에 대해 사용자의 명시적 확인을 요구하고, 요청된 각 권한을 세부적으로 표시하여 사용자가 개별 권한을 선택적으로 승인할 수 있도록 수정합니다.

**상태**: 수정 완료

#### 2. 로컬 스토리지의 불충분한 암호화 (H-02)

**위치**: `packages/extension/src/background/storage.ts`

**설명**: 로컬 스토리지에 저장된 민감한 데이터가 충분히 강력하지 않은 방식으로 암호화되어 있어, 물리적 접근이나 다른 확장 프로그램에 의한 데이터 탈취 위험이 있습니다.

**권장 수정 사항**: 더 강력한 암호화 알고리즘을 사용하고, 키 자료를 유도할 때 더 많은 반복 횟수를 적용하며, 가능한 경우 브라우저의 보안 저장소 API를 활용하도록 수정합니다.

**상태**: 수정 중

### 중간(Medium)

#### 1. 콘텐츠 스크립트의 취약한 DOM 조작 (M-01)

**위치**: `packages/extension/src/contentScript/domWatcher.ts`

**설명**: 콘텐츠 스크립트가 DOM을 조작할 때 적절한 검증이 이루어지지 않아, XSS(Cross-Site Scripting) 공격에 취약할 수 있습니다.

**권장 수정 사항**: 모든 DOM 조작에서 입력 내용을 적절히 검증하고 이스케이프 처리하며, innerHTML 대신 textContent를 사용하도록 수정합니다.

**상태**: 수정 완료

#### 2. 비안전 origins 허용 (M-02)

**위치**: `packages/extension/src/background/networkManager.ts`

**설명**: HTTP를 사용하는 비안전 origins에 대한 연결이 허용되어 있어, 중간자 공격에 취약할 수 있습니다.

**권장 수정 사항**: HTTPS를 사용하는 안전한 origins만 허용하도록 수정하고, 특히 민감한 작업에 대해서는 추가 보안 검증을 적용합니다.

**상태**: 수정 완료

#### 3. 트랜잭션 서명 시 불충분한 정보 표시 (M-03)

**위치**: `packages/extension/src/popup/components/transaction/TransactionConfirmation.tsx`

**설명**: 트랜잭션 서명 확인 화면에서 트랜잭션의 모든 중요 정보가 명확하게 표시되지 않아, 사용자가 악성 트랜잭션을 인지하지 못하고 승인할 위험이 있습니다.

**권장 수정 사항**: 트랜잭션 서명 확인 화면에서 수신자 주소, 금액, 가스 비용, 컨트랙트 상호작용 세부 정보 등 모든 중요 정보를 명확하게 표시하도록 수정합니다.

**상태**: 수정 중

자세한 내용은 [internal_audit_report_extension_part2.md](internal_audit_report_extension_part2.md)를 참조하십시오.