# TORI 지갑 내부 보안 감사 보고서 - 코어 라이브러리

## 개요

이 문서는 TORI 지갑 프로젝트의 코어 라이브러리에 대한 내부 보안 감사 결과를 기록합니다. 감사는 2025년 5월 1일부터 5월 5일까지 진행되었으며, 암호화 모듈, 키 관리 시스템, 지갑 생성 및 복구 메커니즘, 트랜잭션 서명 및 검증, 저장소 보안 등의 영역을 포함했습니다.

## 감사 범위

### 대상 코드
- `packages/core/src/services/crypto/*`
- `packages/core/src/services/storage/*`
- `packages/core/src/services/transaction/*`
- `packages/core/src/types/*`
- `packages/core/src/utils/*`

### 평가 항목
1. 암호화 알고리즘 구현 및 안전성
2. 키 생성 및 관리의 안전성
3. 니모닉 시드 처리 보안
4. 서명 검증 프로세스
5. 데이터 저장 및 접근 제어
6. 트랜잭션 처리 보안
7. 입력 검증 및 예외 처리
8. 의존성 취약점

## 발견된 취약점 요약

총 13개의 보안 이슈가 발견되었으며, 심각도별 분류는 다음과 같습니다:

- **치명적(Critical)**: 0건
- **높음(High)**: 2건
- **중간(Medium)**: 5건
- **낮음(Low)**: 4건
- **정보성(Informational)**: 2건

## 주요 발견 사항

### 높음(High)

#### 1. 비보안 난수 생성기 사용 (H-01)

**위치**: `packages/core/src/services/crypto/mnemonic.ts`

**설명**: 니모닉 시드 생성에 `Math.random()` 함수를 사용하고 있어 예측 가능한 난수가 생성될 위험이 있습니다. 암호화 작업에 적합하지 않은 난수 생성기를 사용하면 공격자가 생성된 키를 예측할 수 있습니다.

**권장 수정 사항**: `Math.random()` 대신 `crypto.getRandomValues()` 또는 `tweetnacl`의 난수 생성 함수를 사용하도록 수정합니다.

**상태**: 수정 완료

#### 2. 키 파생 함수의 낮은 반복 횟수 (H-02)

**위치**: `packages/core/src/services/crypto/encryption.ts`

**설명**: 사용자 비밀번호에서 암호화 키를 파생할 때 PBKDF2의 반복 횟수가 10,000회로 설정되어 있습니다. 최신 하드웨어의 연산 능력을 고려할 때 이는 무차별 대입 공격에 취약할 수 있습니다.

**권장 수정 사항**: PBKDF2의 반복 횟수를 최소 310,000회 이상으로 증가시키거나, 더 강력한 메모리 하드(memory-hard) 함수인 Argon2를 사용하도록 수정합니다.

**상태**: 수정 완료

### 중간(Medium)

#### 1. 저장된 키에 대한 접근 제어 부족 (M-01)

**위치**: `packages/core/src/services/storage/secure.ts`

**설명**: 민감한 키와 시드를 저장하는 보안 저장소에 적절한 접근 제어가 구현되어 있지 않습니다. 인증 없이도 저장된 키에 접근할 수 있는 가능성이 있습니다.

**권장 수정 사항**: 생체 인증이나 PIN과 같은 추가 인증 메커니즘을 사용하여 저장된 키에 대한 접근을 보호하는 레이어를 추가합니다.

**상태**: 수정 중

#### 2. 메모리에 일반 텍스트로 저장된 개인 키 (M-02)

**위치**: `packages/core/src/services/crypto/keyring.ts`

**설명**: 개인 키가 메모리에 일반 텍스트로 저장되어 있어, 메모리 덤프 공격에 취약할 수 있습니다.

**권장 수정 사항**: 개인 키를 사용하지 않을 때는 메모리에서 안전하게 제거하고, 사용 중에는 암호화된 형태로 유지하며 필요한 순간에만 복호화하도록 수정합니다.

**상태**: 수정 중

#### 3. 불충분한 트랜잭션 검증 (M-03)

**위치**: `packages/core/src/services/transaction/validator.ts`

**설명**: 트랜잭션 검증 로직에서 일부 경계 사례를 처리하지 않아 잠재적으로 유효하지 않은 트랜잭션이 승인될 수 있습니다.

**권장 수정 사항**: 모든 트랜잭션 필드에 대한 철저한 유효성 검사를 구현하고, 트랜잭션 유형별로 특정 검증 로직을 추가합니다.

**상태**: 수정 완료

#### 4. HTTP 요청 시 안전하지 않은 헤더 사용 (M-04)

**위치**: `packages/core/src/services/api/base.ts`

**설명**: API 요청에서 민감한 정보가 HTTP 헤더에 일반 텍스트로 전송되고 있습니다.

**권장 수정 사항**: 민감한 정보는 항상 암호화하고, HTTPS를 통해서만 전송하도록 수정합니다. 인증 토큰은 전송 중에 노출되지 않도록 보호합니다.

**상태**: 수정 완료

#### 5. 오류 메시지에 과도한 정보 노출 (M-05)

**위치**: `packages/core/src/services/crypto/hdkey.ts`

**설명**: 오류 메시지에 개인 키 파생 과정에 대한 자세한 정보가 포함되어 있어, 공격자에게 유용한 정보를 제공할 수 있습니다.

**권장 수정 사항**: 오류 메시지를 일반화하고, 민감한 정보나 내부 구현 세부 사항이 노출되지 않도록 수정합니다.

**상태**: 수정 완료

이하 내용은 다음 파일에 계속됩니다. 보다 자세한 내용은 [internal_audit_report_core_part2.md](internal_audit_report_core_part2.md)를 참조하십시오.